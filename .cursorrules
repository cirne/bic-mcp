# BIC MCP Server - Project Context

## Project Overview
MCP server for querying grant transaction data from Beloved In Christ Foundation. Loads data from CSV files in `data/` directory.

---

## PART A: Using the MCP Server

### Query Strategy

**Top Grantees:** Always use `list_grantees` with `sort_by: "total_amount"` - never use `list_transactions` with post-processing.

**Finding Charity Names:** Use `list_grantees({ sort_by: "name" })` first, then use exact `charity` parameter (not `search_term`).

**Common Patterns:**
- Charity since year: `list_transactions({ charity: "Name", min_year: 2023, sort_by: "Sent Date", sort_order: "desc" })`
- Yearly summary: `show_grantee({ charity: "Name" })` (returns yearly totals automatically)
- Large grants: `list_transactions({ year: 2024, min_amount: 25000, sort_by: "Amount", sort_order: "desc" })`
- Top grantees: `list_grantees({ year: 2024, sort_by: "total_amount", sort_order: "desc" })`

### Response Formatting
- Format amounts: "$500,000" not "500000.00"
- Format dates: "October 2, 2025" not "10/2/25"
- Include totals (count, sum) when showing multiple transactions
- Group multi-year data by year
- Include Sent Date, Amount, Grant Purpose in responses

### Special Grantee Relationships

When asked about these organizations, **include grants to related entities**:

#### FRISBE → Trinity College School (TCS)
- **FRISBE** (EIN: 91-1216755) is a U.S. conduit for **Trinity College School** in Canada
- Include grants to both "Trinity College School Fund Inc." (EIN: 13-6187951) and "Friends of Independent Schools and Better Education (FRISBE)"
- Clarify that FRISBE grants go to Trinity College School Foundation

#### Latin American Fellowship → Los Cabos Programs
- **Latin American Fellowship INC** (EIN: 93-6033108, Albany, OR) is a conduit for **Los Cabos special programs** in Baja California Sur, Mexico
- Supports ministries, food banks, and community programs in Los Cabos/BCS region
- Clarify that grants are for Los Cabos programs

#### Freedom Generation Church → Dean Braxton Ministries
- **Freedom Generation Church** (EIN: 75-3094503) fiscally sponsors **Dean Braxton Ministries**
- Many grants explicitly state "Donation for Dean Braxton Ministries" in grant purpose
- Clarify that grants support Dean Braxton Ministries

### When to Use Each Tool
- **`list_transactions`**: Search/filter individual transactions (amounts, dates, purposes)
- **`list_grantees`**: Aggregated grantee data, especially top grantees queries
- **`show_grantee`**: Complete grantee history with yearly totals

---

## PART B: Development Guidelines

### Data Structure
- **Dates**: Format M/D/YY (e.g., "10/2/25" = October 2, 2025). Years 00-30 = 2000-2030, 31-99 = 1931-1999
- **Amounts**: Strings with commas and trailing spaces (e.g., "500,000.00 "). Parse: `amountStr.replace(/,/g, '').replace(/\s/g, '')` then `parseFloat()`
- **Key Fields**: Transaction ID, Charity, Amount, Sent Date, Grant Purpose, EIN, Grant Status

### MCP Tools

#### `list_transactions` - Search/filter transactions
**Parameters:** `search_term`, `charity` (exact match), `year`/`min_year`/`max_year`, `min_amount`/`max_amount`, `sort_by`, `sort_order`, `group_by`, `fields`

#### `list_grantees` - List grantees with aggregated totals
**Parameters:** `year`, `sort_by` ("name", "ein", "recent_date", "total_amount"), `sort_order`
**Returns:** Name, EIN, transaction count, total_amount, most recent grant note
**Use for:** Top grantees queries - provides pre-calculated totals, no post-processing needed

#### `show_grantee` - Detailed grantee info
**Parameters:** `charity` (required, exact name)
**Returns:** Metadata, yearly totals, all transactions

### Implementation Notes
- Fuzzy search uses Fuse.js (threshold 0.4)
- Grantees identified by Charity name + EIN
- Use "Sent Date" as primary date field
- Validate all inputs (type, range, required fields)
